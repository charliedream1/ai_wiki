å†…å®¹æ¥æºï¼šè…¾è®¯å…ƒå®

---

å¦‚æœä½ å·²ç»åœ¨ä¸€å° Linux æœºå™¨ä¸Šæ‹‰å–äº† Docker é•œåƒï¼ˆå¦‚ `modelscope-registry.cn-beijing.cr.aliyuncs.com/modelscope-repo/modelscope:...`ï¼‰ï¼Œå¹¶å¸Œæœ›å°†å…¶å¤åˆ¶åˆ°å¦ä¸€å° Linux æœºå™¨ä¸Šä½¿ç”¨ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š

---

## **æ–¹æ³• 1ï¼šä½¿ç”¨ `docker save` å’Œ `docker load`ï¼ˆæ¨èï¼‰**
è¿™æ˜¯æœ€æ ‡å‡†çš„æ–¹å¼ï¼Œé€‚ç”¨äºè·¨æœºå™¨ä¼ è¾“ Docker é•œåƒã€‚

### **æ­¥éª¤ 1ï¼šåœ¨æºæœºå™¨ä¸Šä¿å­˜é•œåƒä¸º `.tar` æ–‡ä»¶**
```bash
docker save -o modelscope.tar modelscope-registry.cn-beijing.cr.aliyuncs.com/modelscope-repo/modelscope:ubuntu22.04-cuda12.4.0-py310-torch2.6.0-vllm0.8.5.post1-modelscope1.27.1-swift3.5.3
```
- `-o modelscope.tar`ï¼šæŒ‡å®šè¾“å‡ºçš„ `.tar` æ–‡ä»¶åï¼ˆå¯è‡ªå®šä¹‰ï¼‰ã€‚
- `modelscope-registry.cn-beijing.cr.aliyuncs.com/...`ï¼šè¦ä¿å­˜çš„é•œåƒåç§°å’Œæ ‡ç­¾ã€‚

**éªŒè¯ `.tar` æ–‡ä»¶æ˜¯å¦ç”Ÿæˆï¼š**
```bash
ls -lh modelscope.tar
```
åº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸ªè¾ƒå¤§çš„ `.tar` æ–‡ä»¶ï¼ˆé•œåƒå¤§å°å¯èƒ½å‡ åGBï¼‰ã€‚

---

### **æ­¥éª¤ 2ï¼šå°† `.tar` æ–‡ä»¶ä¼ è¾“åˆ°ç›®æ ‡æœºå™¨**
å¯ä»¥ä½¿ç”¨ `scp`ï¼ˆSSH ä¼ è¾“ï¼‰ã€`rsync` æˆ– U ç›˜ç­‰æ–¹å¼ï¼š
```bash
scp modelscope.tar user@ç›®æ ‡æœºå™¨IP:/ç›®æ ‡è·¯å¾„/
```
ä¾‹å¦‚ï¼š
```bash
scp modelscope.tar user@192.168.1.100:/home/user/
```
ï¼ˆ`user` æ˜¯ç›®æ ‡æœºå™¨çš„ç”¨æˆ·åï¼Œ`192.168.1.100` æ˜¯ç›®æ ‡æœºå™¨ IPï¼‰

---

### **æ­¥éª¤ 3ï¼šåœ¨ç›®æ ‡æœºå™¨ä¸ŠåŠ è½½é•œåƒ**
```bash
docker load -i /ç›®æ ‡è·¯å¾„/modelscope.tar
```
- `-i /ç›®æ ‡è·¯å¾„/modelscope.tar`ï¼šæŒ‡å®šè¦åŠ è½½çš„ `.tar` æ–‡ä»¶è·¯å¾„ã€‚

**éªŒè¯é•œåƒæ˜¯å¦åŠ è½½æˆåŠŸï¼š**
```bash
docker images
```
åº”è¯¥èƒ½çœ‹åˆ°ç›¸åŒçš„é•œåƒï¼ˆåç§°å’Œæ ‡ç­¾ä¸€è‡´ï¼‰ã€‚

---

### **æ­¥éª¤ 4ï¼šè¿è¡Œé•œåƒï¼ˆå¯é€‰ï¼‰**
```bash
docker run -it --gpus all modelscope-registry.cn-beijing.cr.aliyuncs.com/modelscope-repo/modelscope:ubuntu22.04-cuda12.4.0-py310-torch2.6.0-vllm0.8.5.post1-modelscope1.27.1-swift3.5.3 /bin/bash
```
ï¼ˆå¦‚æœç›®æ ‡æœºå™¨æœ‰ GPU ä¸”å®‰è£…äº† NVIDIA Docker é©±åŠ¨ï¼‰

---

## **æ–¹æ³• 2ï¼šç›´æ¥å¤åˆ¶ Docker é•œåƒå­˜å‚¨ç›®å½•ï¼ˆä¸æ¨èï¼‰**
Docker é•œåƒé»˜è®¤å­˜å‚¨åœ¨ `/var/lib/docker`ï¼ˆå…·ä½“è·¯å¾„å¯é€šè¿‡ `docker info | grep "Docker Root Dir"` æŸ¥çœ‹ï¼‰ã€‚  
ä½ å¯ä»¥ç›´æ¥å¤åˆ¶æ•´ä¸ª `/var/lib/docker` ç›®å½•åˆ°ç›®æ ‡æœºå™¨ï¼Œä½†è¿™ç§æ–¹æ³•ï¼š
- **ä¸æ¨è**ï¼šå› ä¸º Docker çš„å­˜å‚¨ç»“æ„å¤æ‚ï¼Œç›´æ¥å¤åˆ¶å¯èƒ½å¯¼è‡´æ•°æ®æŸåæˆ–å†²çªã€‚
- **ä»…é€‚ç”¨äºæµ‹è¯•ç¯å¢ƒ**ï¼šå¦‚æœä¸¤å°æœºå™¨çš„ Docker ç‰ˆæœ¬ã€å­˜å‚¨é©±åŠ¨å®Œå…¨ä¸€è‡´ï¼Œå¯ä»¥å°è¯•ï¼Œä½†é£é™©è¾ƒé«˜ã€‚

**æ“ä½œæ­¥éª¤ï¼ˆä»…ä½œå‚è€ƒï¼Œä¸æ¨èç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼‰ï¼š**
1. åœ¨æºæœºå™¨ä¸Šåœæ­¢ Dockerï¼š
   ```bash
   sudo systemctl stop docker
   ```
2. å¤åˆ¶ `/var/lib/docker` åˆ°ç›®æ ‡æœºå™¨ï¼ˆä½¿ç”¨ `scp` æˆ– `rsync`ï¼‰ï¼š
   ```bash
   scp -r /var/lib/docker user@ç›®æ ‡æœºå™¨IP:/var/lib/
   ```
3. åœ¨ç›®æ ‡æœºå™¨ä¸Šå¯åŠ¨ Dockerï¼š
   ```bash
   sudo systemctl start docker
   ```
4. æ£€æŸ¥é•œåƒæ˜¯å¦å¯ç”¨ï¼š
   ```bash
   docker images
   ```

âš ï¸ **æ³¨æ„**ï¼šè¿™ç§æ–¹æ³•å®¹æ˜“å¯¼è‡´ Docker æ•°æ®æŸåï¼Œå»ºè®®ä¼˜å…ˆä½¿ç”¨ `docker save/load`ã€‚

---

## **æ–¹æ³• 3ï¼šä½¿ç”¨ Docker Hub æˆ–ç§æœ‰ä»“åº“æ¨é€/æ‹‰å–ï¼ˆé€‚åˆé•¿æœŸä½¿ç”¨ï¼‰**
å¦‚æœä¸¤å°æœºå™¨éƒ½èƒ½è®¿é—®äº’è”ç½‘æˆ–åŒä¸€ä¸ªç§æœ‰ Docker ä»“åº“ï¼Œå¯ä»¥ï¼š
1. **åœ¨æºæœºå™¨ä¸Šç™»å½• Docker Hub æˆ–ç§æœ‰ä»“åº“**ï¼š
   ```bash
   docker login
   ```
2. **ç»™é•œåƒæ‰“æ ‡ç­¾å¹¶æ¨é€åˆ°ä»“åº“**ï¼š
   ```bash
   docker tag modelscope-registry.cn-beijing.cr.aliyuncs.com/modelscope-repo/modelscope:ubuntu22.04-cuda12.4.0-py310-torch2.6.0-vllm0.8.5.post1-modelscope1.27.1-swift3.5.3 your-dockerhub-username/modelscope:tag
   docker push your-dockerhub-username/modelscope:tag
   ```
3. **åœ¨ç›®æ ‡æœºå™¨ä¸Šæ‹‰å–é•œåƒ**ï¼š
   ```bash
   docker pull your-dockerhub-username/modelscope:tag
   ```

**é€‚ç”¨åœºæ™¯**ï¼š
- éœ€è¦é•¿æœŸå…±äº«é•œåƒã€‚
- ä¸¤å°æœºå™¨éƒ½èƒ½è®¿é—®äº’è”ç½‘æˆ–åŒä¸€ä¸ªç§æœ‰ä»“åº“ã€‚

---

## **æ¨èæ–¹æ¡ˆæ€»ç»“**
| æ–¹æ³• | é€‚ç”¨åœºæ™¯ | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|----------|------|------|
| **`docker save/load`** | ä¸´æ—¶ä¼ è¾“é•œåƒ | ç®€å•ã€å¯é  | éœ€è¦æ‰‹åŠ¨ä¼ è¾“ `.tar` æ–‡ä»¶ |
| **ç›´æ¥å¤åˆ¶ `/var/lib/docker`** | æµ‹è¯•ç¯å¢ƒï¼ˆä¸æ¨èç”Ÿäº§ï¼‰ | æ— éœ€é¢å¤–æ“ä½œ | å®¹æ˜“æŸå Docker æ•°æ® |
| **Docker Hub/ç§æœ‰ä»“åº“** | é•¿æœŸå…±äº«é•œåƒ | è‡ªåŠ¨åŒ–ã€å¯æ‰©å±• | éœ€è¦ç½‘ç»œå’Œä»“åº“æ”¯æŒ |

**æœ€ä½³å®è·µ**ï¼š  
âœ… **ä¼˜å…ˆä½¿ç”¨ `docker save/load`**ï¼ˆæ–¹æ³• 1ï¼‰ï¼Œç®€å•å¯é ã€‚  
âœ… å¦‚æœéœ€è¦é•¿æœŸå…±äº«ï¼Œå¯ä»¥æ¨é€åˆ° **Docker Hub æˆ–ç§æœ‰ä»“åº“**ï¼ˆæ–¹æ³• 3ï¼‰ã€‚  
âŒ **é¿å…ç›´æ¥å¤åˆ¶ `/var/lib/docker`**ï¼ˆæ–¹æ³• 2ï¼‰ï¼Œé™¤éä½ å®Œå…¨äº†è§£é£é™©ã€‚

---

## **å¸¸è§é—®é¢˜**
### **Q1ï¼š`docker save` ç”Ÿæˆçš„ `.tar` æ–‡ä»¶å¤ªå¤§æ€ä¹ˆåŠï¼Ÿ**
- Docker é•œåƒå¯èƒ½åŒ…å«å¤šå±‚ï¼ˆlayersï¼‰ï¼Œå¯¼è‡´æ–‡ä»¶è¾ƒå¤§ã€‚
- å¯ä»¥ä½¿ç”¨ `docker history <é•œåƒå>` æŸ¥çœ‹é•œåƒçš„æ„å»ºå±‚ï¼Œä¼˜åŒ–é•œåƒå¤§å°ï¼ˆå¦‚å‡å°‘ä¸å¿…è¦çš„ä¾èµ–ï¼‰ã€‚

### **Q2ï¼šç›®æ ‡æœºå™¨æ²¡æœ‰ GPUï¼Œèƒ½è¿è¡Œ CUDA é•œåƒå—ï¼Ÿ**
- **ä¸èƒ½**ï¼šå¦‚æœé•œåƒä¾èµ– CUDAï¼ˆå¦‚ `ubuntu22.04-cuda12.4.0`ï¼‰ï¼Œç›®æ ‡æœºå™¨å¿…é¡»å®‰è£… NVIDIA é©±åŠ¨å’Œ `nvidia-container-toolkit`ã€‚
- å¦‚æœç›®æ ‡æœºå™¨æ²¡æœ‰ GPUï¼Œå¯ä»¥ï¼š
  1. åœ¨æºæœºå™¨ä¸Šæ‹‰å– **CPU ç‰ˆæœ¬é•œåƒ**ï¼ˆå¦‚æœæœ‰ï¼‰ã€‚
  2. æˆ–è€…é‡æ–°æ„å»ºä¸€ä¸ª CPU ç‰ˆæœ¬çš„é•œåƒï¼ˆä¿®æ”¹ Dockerfileï¼‰ã€‚

### **Q3ï¼šå¦‚ä½•æ£€æŸ¥ `.tar` æ–‡ä»¶æ˜¯å¦å®Œæ•´ï¼Ÿ**
- å¯ä»¥è®¡ç®—æ–‡ä»¶çš„ MD5 æˆ– SHA256 æ ¡éªŒå€¼ï¼š
  ```bash
  md5sum modelscope.tar
  sha256sum modelscope.tar
  ```
- åœ¨ç›®æ ‡æœºå™¨ä¸ŠåŠ è½½åï¼Œæ£€æŸ¥é•œåƒæ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

---

å¦‚æœä½ æœ‰æ›´å…·ä½“çš„éœ€æ±‚ï¼ˆå¦‚è·¨ç½‘ç»œä¼ è¾“ã€è‡ªåŠ¨åŒ–è„šæœ¬ç­‰ï¼‰ï¼Œå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–æ–¹æ¡ˆï¼ ğŸš€